<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Visakh Money Tracker</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
  :root{
    --bg:#f4f7fb; --card:#fff; --accent:#6b5ef8; --accent2:#8c6bff;
    --muted:#6b7280; --green:#16a34a; --danger:#ef4444;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#eef2ff,#f4f7fb);color:#0b1220}
  /* splash */
  #splash{
    position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:9999;
    background:linear-gradient(135deg,#0f172a,#111827);
    color:#fff; flex-direction:column;
  }
  .cash-wrap{position:relative;width:260px;height:120px;overflow:visible}
  .cash{position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); font-size:48px; opacity:0; animation:fly 1700ms ease-in-out forwards;}
  .cash.c1{animation-delay:0} .cash.c2{animation-delay:250ms} .cash.c3{animation-delay:500ms}
  @keyframes fly{0%{transform:translate(-50%,60%) scale(.6) rotate(-10deg);opacity:0} 40%{opacity:1;transform:translate(-50%,-10%) scale(1.05) rotate(3deg)} 100%{transform:translate(-50%,-180%) scale(.85) rotate(-6deg);opacity:0}}
  .splash-title{font-size:20px;margin-top:6px;font-weight:700} .splash-sub{opacity:.85;font-size:13px;margin-top:6px}
  /* app */
  .app{max-width:920px;margin:16px auto;padding:12px}
  header{display:flex;align-items:center;justify-content:space-between;padding:12px 6px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,#fff,#f0f1ff);display:flex;align-items:center;justify-content:center;font-size:22px}
  h1{margin:0;font-size:18px}
  .balance{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;padding:8px 12px;border-radius:12px;font-weight:700}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
  .toolbar button{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
  .card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 10px 30px rgba(20,20,60,0.04)}
  .entry-card{display:block}
  .row{display:flex;gap:8px;margin-bottom:8px}
  .row input,.row select{flex:1;padding:12px;border-radius:10px;border:1px solid #eef0fb;font-size:0.95rem}
  .row select{max-width:160px}
  .actions{display:flex;gap:8px;justify-content:flex-end}
  button.primary{background:var(--accent);color:#fff;padding:12px;border-radius:12px;border:none;font-weight:700;flex:1}
  button.ghost{background:#f3f5ff;color:var(--muted);padding:12px;border-radius:12px;border:none;flex:1}
  .summary{display:flex;gap:12px;margin:12px 0;flex-wrap:wrap}
  .summary .card{flex:1;min-width:180px}
  .list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .item{background:var(--card);padding:10px;border-radius:12px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 6px 24px rgba(20,20,50,0.03)}
  .chip{padding:6px 8px;border-radius:8px;background:#f0f2ff;color:var(--accent);font-weight:700}
  .controls{display:flex;gap:6px}
  .icon-btn{border:1px solid #eee;background:transparent;padding:8px;border-radius:8px;cursor:pointer}
  .reports{margin-top:12px}
  .chart-wrap{height:220px}
  footer{text-align:center;color:var(--muted);margin-top:14px}
  .premium-badge{background:linear-gradient(90deg,#ffd84a,#ffb84a);padding:6px 10px;border-radius:999px;color:#111;font-weight:700}
  /* modal */
  .modal{display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);padding:18px;z-index:9999}
  .modal .box{background:white;padding:14px;border-radius:12px;max-width:520px;width:100%}
  .modal .close{float:right;border:none;background:transparent;font-size:18px;cursor:pointer}
  .admin-btn{position:fixed;right:12px;bottom:12px;background:#111;color:#fff;padding:10px;border-radius:10px;border:none;cursor:pointer;z-index:999}
  @media (max-width:640px){ .row{flex-direction:column} .toolbar{gap:6px} .logo{width:44px;height:44px} }
</style>
</head>
<body>

<!-- Splash -->
<div id="splash">
  <div class="cash-wrap" aria-hidden="true">
    <div class="cash c1">ðŸ’¸</div>
    <div class="cash c2">ðŸ’µ</div>
    <div class="cash c3">ðŸ§¾</div>
  </div>
  <div class="splash-title">Visakh Money Tracker</div>
  <div class="splash-sub">Smart. Simple. Secure.</div>
</div>

<!-- App -->
<div class="app" style="display:none">
  <header>
    <div class="brand">
      <div class="logo">ðŸ’µ</div>
      <div>
        <h1>Visakh Money Tracker <div style="font-size:12px;color:var(--muted)">by EnergyMoney</div></h1>
      </div>
    </div>
    <div style="display:flex;align-items:center">
      <div class="balance" id="balance">â‚¹0.00</div>
      <div id="badgeArea" style="margin-left:10px"></div>
    </div>
  </header>

  <div class="toolbar">
    <button id="exportCsvBtn">Export CSV (Excel)</button>
    <button id="exportPdfBtn">Export Monthly PDF</button>
    <button id="dailyReportBtn">Daily Summary</button>
    <button id="monthlyReportBtn">Monthly Summary</button>
    <button id="upgradeBtn" style="background:#fff;color:var(--accent);border:1px solid #e6e0ff;font-weight:700">Upgrade â‚¹29 / â‚¹299</button>
  </div>

  <section class="card entry-card">
    <div class="row">
      <select id="type">
        <option value="expense">Expense</option>
        <option value="income">Income</option>
      </select>
      <input id="amount" type="number" placeholder="Enter amount (â‚¹)" />
    </div>
    <div class="row">
      <select id="category">
        <option>Food</option><option>Transport</option><option>Shopping</option><option>Bills</option><option>Health</option><option>EMI</option><option>Salary</option><option>Others</option>
      </select>
      <input id="description" type="text" placeholder="Description" />
    </div>
    <div class="row actions">
      <button id="addBtn" class="primary">Add</button>
      <button id="clearBtn" class="ghost">Clear All</button>
    </div>
    <div id="limitInfo" style="margin-top:8px;color:var(--muted)">Entries this month: 0 / 100 (free)</div>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button id="backupBtn" class="ghost">Backup Data</button>
      <input id="restoreFile" type="file" accept=".json" style="display:none" />
      <button id="restoreBtn" class="ghost">Restore Data</button>
    </div>
  </section>

  <section class="summary" style="margin-top:12px">
    <div class="card"><div class="label">Today's Total</div><div id="todayTotal" class="value">â‚¹0.00</div></div>
    <div class="card"><div class="label">This Month</div><div id="monthTotal" class="value">â‚¹0.00</div></div>
    <div class="card"><div class="label">Income vs Expense</div><div id="incExp" class="value">â‚¹0 / â‚¹0</div></div>
  </section>

  <section class="history">
    <h3>History</h3>
    <div id="historyList" class="list"></div>
  </section>

  <section class="reports card">
    <h3>Reports</h3>
    <div class="chart-wrap"><canvas id="catChart"></canvas></div>
    <div id="monthlyReport" style="margin-top:12px"></div>
  </section>

  <footer>Local only â€” data saved on this device. Premium: Export PDF & CSV</footer>
</div>

<!-- Modal -->
<div id="modal" class="modal"><div class="box">
  <button class="close" id="modalClose">âœ•</button>
  <div id="modalContent"></div>
</div></div>

<!-- Admin button -->
<button id="adminBtn" class="admin-btn">Admin</button>

<script>
/* Single-file app with premium persistence and backup/restore */

// CONFIG
const STORAGE_KEY = "visakh_money_v1";
const PREMIUM_KEY = "visakh_premium_v1";
const ENTRY_LIMIT = 100;
const ADMIN_PASSWORD = "admin123";
const ADMIN_PHONE_FULL = "919544599733";
const UPI_ID = "visakhsivaji95-4@okhdfcbank";
const UPI_QR_SRC = "upi_qr.png"; // upload to repo root or change to hosted URL

// DOM helpers
const $ = id => document.getElementById(id);
const appDiv = document.querySelector('.app');
const addBtn = $("addBtn"), clearBtn = $("clearBtn"), historyList = $("historyList");
const balanceEl = $("balance"), todayTotalEl = $("todayTotal"), monthTotalEl = $("monthTotal"), incExpEl = $("incExp");
const exportCsvBtn = $("exportCsvBtn"), exportPdfBtn = $("exportPdfBtn"), upgradeBtn = $("upgradeBtn");
const modal = $("modal"), modalContent = $("modalContent"), modalClose = $("modalClose");
const adminBtn = $("adminBtn"), monthlyReportEl = $("monthlyReport"), badgeArea = $("badgeArea");
const backupBtn = $("backupBtn"), restoreBtn = $("restoreBtn"), restoreFile = $("restoreFile");
const limitInfo = $("limitInfo");

// state
let entries = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
let premiumInfo = JSON.parse(localStorage.getItem(PREMIUM_KEY) || "null"); // { phone, expiryISO }
let catChart = null;

// utilities
function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(entries)); localStorage.setItem(PREMIUM_KEY, JSON.stringify(premiumInfo)); }
function formatMoney(n){ return "â‚¹" + Number(n).toLocaleString('en-IN', {minimumFractionDigits:2,maximumFractionDigits:2}); }
function monthKeyFor(date=new Date()){ return `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}`; }
function monthLabel(date=new Date()){ return date.toLocaleString('default',{month:'short', year:'numeric'}); }
function nowISO(){ return new Date().toISOString(); }

// splash -> show app after animation
setTimeout(()=>{ document.getElementById('splash').style.display='none'; appDiv.style.display='block'; checkPremiumOnLoad(); updateAll(); }, 1700);

// PREMIUM: check on load
function isPremiumActive(){
  if(!premiumInfo) return false;
  const exp = new Date(premiumInfo.expiry);
  return new Date() < exp;
}
function checkPremiumOnLoad(){
  if(isPremiumActive()){
    renderBadge(true);
  } else {
    // clear expired
    premiumInfo = null;
    localStorage.removeItem(PREMIUM_KEY);
    renderBadge(false);
  }
}
function renderBadge(show){
  badgeArea.innerHTML = '';
  if(show){
    const b = document.createElement('div'); b.className='premium-badge'; b.innerText='PREMIUM';
    badgeArea.appendChild(b);
  }
}

// RENDER LIST
function renderList(){
  historyList.innerHTML = "";
  const list = [...entries].reverse();
  list.forEach(item=>{
    const el = document.createElement('div'); el.className='item';
    const left = document.createElement('div'); left.className='left';
    const chip = document.createElement('div'); chip.className='chip'; chip.innerText = item.type === 'income' ? 'Income' : 'Expense';
    const desc = document.createElement('div'); desc.className='desc'; desc.innerText = `${item.desc} â€” ${item.category}`;
    const meta = document.createElement('div'); meta.className='meta'; meta.innerText = `${new Date(item.ts).toLocaleString()} â€¢ ${formatMoney(item.amount)}`;
    left.appendChild(chip); left.appendChild(desc); left.appendChild(meta);
    const controls = document.createElement('div'); controls.className='controls';
    const editBtn = document.createElement('button'); editBtn.className='icon-btn'; editBtn.innerText='Edit';
    const delBtn = document.createElement('button'); delBtn.className='icon-btn'; delBtn.innerText='Delete';
    delBtn.addEventListener('click', ()=>{ if(confirm('Delete this entry?')){ const idx = entries.findIndex(e=> e.ts === item.ts); if(idx>-1){ entries.splice(idx,1); save(); updateAll(); } } });
    editBtn.addEventListener('click', ()=>{ $("amount").value = item.amount; $("description").value = item.desc; $("category").value = item.category; $("type").value = item.type; const idx = entries.findIndex(e=> e.ts === item.ts); if(idx>-1){ entries.splice(idx,1); save(); updateAll(); } window.scrollTo({top:0,behavior:'smooth'}); });
    controls.appendChild(editBtn); controls.appendChild(delBtn);
    el.appendChild(left); el.appendChild(controls);
    historyList.appendChild(el);
  });
}

// SUMMARY + limit info
function computeSummary(){
  const now = new Date();
  const today = now.toDateString();
  let todayTotal=0, monthTotal=0, incomeTotal=0, expenseTotal=0;
  const mk = monthKeyFor();
  entries.forEach(e=>{
    const amt = Number(e.amount);
    if(e.type === 'income') incomeTotal += amt; else expenseTotal += amt;
    if(e.dateStr === today) todayTotal += (e.type === 'expense' ? -amt : amt);
    if(e.monthKey === mk) monthTotal += (e.type === 'expense' ? -amt : amt);
  });
  balanceEl.innerText = formatMoney(incomeTotal - expenseTotal);
  todayTotalEl.innerText = formatMoney(todayTotal);
  monthTotalEl.innerText = formatMoney(monthTotal);
  incExpEl.innerText = `${formatMoney(incomeTotal)} / ${formatMoney(expenseTotal)}`;
  const used = entries.filter(e=> e.monthKey === mk).length;
  limitInfo.innerText = `Entries this month: ${used} / ${ENTRY_LIMIT} (free)`;
}

// CHART and monthly table
function buildCategoryData(){
  const mk = monthKeyFor(); const cats={"Food":0,"Transport":0,"Shopping":0,"Bills":0,"Health":0,"EMI":0,"Salary":0,"Others":0};
  entries.forEach(e=> { if(e.monthKey === mk && e.type === 'expense'){ cats[e.category] = (cats[e.category]||0) + Number(e.amount); } });
  return {categories:Object.keys(cats), values:Object.values(cats)};
}
function renderChart(){
  const ctx = document.getElementById('catChart').getContext('2d'); const data = buildCategoryData();
  if(catChart) catChart.destroy();
  catChart = new Chart(ctx,{ type:'doughnut', data:{ labels:data.categories, datasets:[{ data:data.values }] }, options:{plugins:{legend:{position:'bottom'}}, maintainAspectRatio:false } });
}
function buildMonthlyReport(){
  const months=[]; const totals=[]; const now = new Date();
  for(let i=5;i>=0;i--){ const d = new Date(now.getFullYear(), now.getMonth()-i, 1); months.push(d.toLocaleString('default',{month:'short',year:'numeric'})); totals.push(0); }
  entries.forEach(e=>{ const idx = months.indexOf(e.monthLabel); if(idx>-1) totals[idx] += (e.type==='expense' ? -Number(e.amount) : Number(e.amount)); });
  let html = "<table style='width:100%;border-collapse:collapse'><thead><tr><th style='text-align:left;padding:6px'>Month</th><th style='text-align:right;padding:6px'>Total (â‚¹)</th></tr></thead><tbody>";
  months.forEach((m,i)=> html += `<tr><td style='padding:6px'>${m}</td><td style='padding:6px;text-align:right'>${formatMoney(totals[i])}</td></tr>`);
  html += "</tbody></table>";
  monthlyReportEl.innerHTML = html;
}

// update everything
function updateAll(){ renderList(); computeSummary(); renderChart(); buildMonthlyReport(); save(); renderBadge(isPremiumActive()); }

// limit check
function checkLimit(){ const mk = monthKeyFor(); return entries.filter(e => e.monthKey === mk).length < ENTRY_LIMIT; }

// ADD ENTRY (no repeated phone prompt for premium)
addBtn.addEventListener('click', ()=>{
  // if premium not active => enforce limit and ask to upgrade
  if(!isPremiumActive() && !checkLimit()){ showUpgradeModal(); return; }
  const amt = $("amount").value.trim(); const desc = $("description").value.trim(); const cat = $("category").value; const type = $("type").value;
  if(!amt || isNaN(amt) || Number(amt) <= 0){ alert('Please enter a valid amount'); return; }
  if(!desc){ alert('Please add description'); return; }
  const now = new Date();
  const entry = { amount: Number(amt), desc, category: cat, type, ts: Date.now(), dateStr: now.toDateString(), monthKey: monthKeyFor(now), monthLabel: monthLabel(now) };
  entries.push(entry); save(); updateAll();
  $("amount").value=''; $("description").value='';
});

// clear
clearBtn.addEventListener('click', ()=>{ if(confirm('Clear all entries? This cannot be undone.')){ entries=[]; save(); updateAll(); } });

// EXPORT CSV (premium only)
exportCsvBtn.addEventListener('click', ()=>{
  if(!isPremiumActive()){ showUpgradeModal(); return; }
  const rows = [["Date","Type","Category","Description","Amount (â‚¹)"]];
  entries.forEach(e => rows.push([ new Date(e.ts).toLocaleString(), e.type, e.category, e.desc, e.amount ]));
  const csv = rows.map(r => r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = `moneytracker_export_${monthKeyFor()}.csv`; a.click(); URL.revokeObjectURL(url);
});

// EXPORT PDF (premium only)
exportPdfBtn.addEventListener('click', async ()=>{
  if(!isPremiumActive()){ showUpgradeModal(); return; }
  if(!window.jspdf || !window.html2canvas){ alert('PDF libraries not loaded. Try again.'); return; }
  const { jsPDF } = window.jspdf; const doc = new jsPDF('p','pt','a4'); const now = new Date(); const monthName = now.toLocaleString('default',{month:'long',year:'numeric'});
  doc.setFontSize(16); doc.text('Visakh Money Tracker â€” Monthly Report',20,30); doc.setFontSize(11); doc.text(`Month: ${monthName}`,20,46);
  let income=0, expense=0;
  entries.forEach(e => { const d=new Date(e.ts); if(d.getMonth()===now.getMonth() && d.getFullYear()===now.getFullYear()){ if(e.type==='income') income+=Number(e.amount); else expense+=Number(e.amount); }});
  doc.setFontSize(12); doc.text(`Income: ${formatMoney(income)}`,20,86); doc.text(`Expense: ${formatMoney(expense)}`,20,102); doc.text(`Balance: ${formatMoney(income-expense)}`,20,118);
  try{
    const canvas = document.getElementById('catChart'); const img = await html2canvas(canvas, {backgroundColor:null}); const imgData = img.toDataURL('image/png');
    doc.addImage(imgData,'PNG',360,40,200,200);
  }catch(e){ console.warn('Chart capture failed',e); }
  doc.setFontSize(11); let y=160; doc.text('Entries:',20,y); y+=12;
  entries.forEach(e => { const d=new Date(e.ts); if(d.getMonth()===now.getMonth() && d.getFullYear()===now.getFullYear()){ const line = `${d.toLocaleDateString()} ${d.toLocaleTimeString()} | ${e.type} | ${e.category} | ${e.desc} | â‚¹${e.amount}`; doc.text(line,20,y); y+=12; if(y>760){ doc.addPage(); y=40; } }});
  doc.setFontSize(10); doc.text(`Visakh Payment (UPI): ${UPI_ID}`,20,790);
  doc.save(`MoneyTracker_Monthly_${monthName}.pdf`);
});

// Upgrade modal with monthly and 3-year option
function showUpgradeModal(){
  modalContent.innerHTML = `
    <button class="close" id="modalCloseInner">âœ•</button>
    <h3>Upgrade to Premium</h3>
    <p>Choose a plan â€” Monthly â‚¹29 (1 month) or 3 years â‚¹299</p>
    <div style="display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap;margin:12px 0">
      <div style="width:180px;height:220px;border-radius:10px;background:#f7f8ff;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:10px">
        <img src="${UPI_QR_SRC}" alt="UPI QR" style="max-width:160px;max-height:160px;margin-bottom:8px" onerror="this.style.display='none'"/>
        <small>Scan to pay via UPI</small>
      </div>
      <div style="flex:1;min-width:200px">
        <p><strong>Visakh Payment</strong></p>
        <p>UPI ID: <strong>${UPI_ID}</strong></p>
        <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
          <button id="payMonthly" style="background:var(--accent);color:#fff;padding:10px;border-radius:8px;border:none">Pay â‚¹29 â€” 1 month</button>
          <button id="pay3yr" style="background:var(--green);color:#fff;padding:10px;border-radius:8px;border:none">Pay â‚¹299 â€” 3 years</button>
        </div>
        <p style="color:var(--muted);margin-top:8px">After payment, click "I Paid" and enter the phone used for payment â€” app saves premium until expiry.</p>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="iPaid" class="ghost">I Paid â€” Enter Phone</button>
          <a href="https://wa.me/${ADMIN_PHONE_FULL}?text=I+need+help+to+upgrade+Money+Tracker" target="_blank"><button style="background:#25D366;color:#fff;padding:10px;border-radius:8px;border:none">WhatsApp Admin</button></a>
        </div>
      </div>
    </div>
  `;
  modal.style.display='flex';
  $("modalCloseInner").onclick = ()=> modal.style.display='none';
  // clicking pay options just open WhatsApp/admin for real payment; user must click I Paid then enter phone
  $("payMonthly").onclick = ()=> window.open(`https://wa.me/${ADMIN_PHONE_FULL}?text=I+want+to+pay+â‚¹29+for+monthly+premium`,'_blank');
  $("pay3yr").onclick = ()=> window.open(`https://wa.me/${ADMIN_PHONE_FULL}?text=I+want+to+pay+â‚¹299+for+3year+premium`,'_blank');
  $("iPaid").onclick = ()=> {
    const phone = prompt('Enter the phone number you used for payment (include country code or 10-digit):');
    if(!phone) return alert('Please enter phone number.');
    const plan = confirm('Press OK for 3-year plan (â‚¹299). Press Cancel for monthly (â‚¹29).') ? '3yr' : '1mo';
    let expiry = new Date();
    if(plan === '3yr'){ expiry.setFullYear(expiry.getFullYear() + 3); } else { expiry.setMonth(expiry.getMonth() + 1); }
    premiumInfo = { phone: phone.trim(), expiry: expiry.toISOString() };
    save();
    alert('Thank you! Premium activated locally until ' + expiry.toDateString());
    modal.style.display='none';
    updateAll();
  };
}

// ADMIN panel: manage premium phones and force-add expiry entries
adminBtn.addEventListener('click', ()=>{
  const pass = prompt('Enter admin password:');
  if(pass !== ADMIN_PASSWORD){ alert('Wrong password'); return; }
  modalContent.innerHTML = `
    <button class="close" id="admClose">âœ•</button>
    <h3>Admin â€” Manage Premium</h3>
    <p>Set premium user (phone) or clear premium.</p>
    <input id="admPhone" placeholder="Phone e.g. 919544599733" />
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="admAdd" style="background:var(--accent);color:#fff;padding:8px;border-radius:8px;border:none">Set Premium (1mo)</button>
      <button id="admAdd3" style="background:var(--green);color:#fff;padding:8px;border-radius:8px;border:none">Set Premium (3yr)</button>
      <button id="admClear" class="ghost">Clear Premium</button>
    </div>
    <div style="margin-top:12px"><strong>Current premium:</strong><div id="admCurrent" style="margin-top:8px">${premiumInfo ? (premiumInfo.phone + ' until ' + new Date(premiumInfo.expiry).toDateString()) : 'None'}</div></div>
  `;
  modal.style.display='flex';
  $("admClose").onclick = ()=> modal.style.display='none';
  $("admAdd").onclick = ()=> { const p=$("admPhone").value.trim(); if(!p) return alert('Enter phone'); let expiry = new Date(); expiry.setMonth(expiry.getMonth()+1); premiumInfo = {phone:p, expiry:expiry.toISOString()}; save(); alert('Premium set for 1 month'); updateAll(); $("admCurrent").innerText = premiumInfo.phone + ' until ' + new Date(premiumInfo.expiry).toDateString(); };
  $("admAdd3").onclick = ()=> { const p=$("admPhone").value.trim(); if(!p) return alert('Enter phone'); let expiry=new Date(); expiry.setFullYear(expiry.getFullYear()+3); premiumInfo = {phone:p, expiry:expiry.toISOString()}; save(); alert('Premium set for 3 years'); updateAll(); $("admCurrent").innerText = premiumInfo.phone + ' until ' + new Date(premiumInfo.expiry).toDateString(); };
  $("admClear").onclick = ()=> { if(confirm('Clear premium?')){ premiumInfo=null; save(); updateAll(); $("admCurrent").innerText='None'; } };
});

// Backup & Restore
backupBtn.addEventListener('click', ()=>{
  const payload = { entries, premiumInfo, exportedAt: new Date().toISOString() };
  const blob = new Blob([JSON.stringify(payload)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = `moneytracker_backup_${new Date().toISOString().slice(0,10)}.json`; a.click(); URL.revokeObjectURL(url);
});
restoreBtn.addEventListener('click', ()=> restoreFile.click());
restoreFile.addEventListener('change', (e)=>{
  const f = e.target.files[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = (ev)=>{
    try{
      const data = JSON.parse(ev.target.result);
      if(!data.entries) return alert('Invalid backup file');
      entries = data.entries;
      premiumInfo = data.premiumInfo || null;
      save(); updateAll(); alert('Data restored successfully');
    }catch(err){ alert('Error reading file'); }
  };
  reader.readAsText(f);
});

// modal close
modalClose.addEventListener('click', ()=> modal.style.display='none');

// init update
function updateAll(){ renderList(); computeSummary(); renderChart(); buildMonthlyReport(); save(); renderBadge(isPremiumActive()); }
updateAll();
</script>
</body>
</html>
